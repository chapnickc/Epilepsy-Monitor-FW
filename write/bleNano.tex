%\documentclass{standalone}

\usepackage{circuitikz}
\usepackage{fp}

% -----------------------------------------------------
%                   Initialize
% -----------------------------------------------------
\ctikzset{multipoles/.is family}
\ctikzset{multipoles/pin spacing/.initial = 5mm} % default value

\pgfkeys{/tikz/pin spacing/.initial = 0mm}
\pgfkeys{/tikz/pin spacing/.default = 0mm}


\newlength{\IClen}  % scale factor

% make the pin size small if integrated circuit is small is small
\newcommand{\pinsize}{\ifdim\IClen<3.5mm \tiny \else \scriptsize \fi}

% Initialize BLE Nano
\pgfdeclareshape{bleNano}{
    \anchor{center}{\pgfpointorigin} % within the node, (0,0) is the center

    % this is used to center the text in the node
    \anchor{text}{\pgfpoint{-.5\wd\pgfnodeparttextbox}{5.5\ht\pgfnodeparttextbox}}

    \savedmacro{\resize}{   % called automatically
        \setlength{\IClen}{\pgfkeysvalueof{/tikz/pin spacing}} % from node[]
        \ifdim\IClen=0mm 
            \setlength{\IClen}
            {\pgfkeysvalueof{/tikz/circuitikz/multipoles/pin spacing}} 
        \fi    % from \ctikzset{}
    }

% ----------------------------------------------------------
%                     Define Pin Anchors
% ----------------------------------------------------------

% starting at top left corner and going down:
    \savedanchor\icpinla{\pgfpoint{-3.2 \IClen}{2\IClen}}  \anchor{p1}{\icpinla}
    \savedanchor\icpinlb{\pgfpoint{-3.2\IClen}{1\IClen}}  \anchor{p2}{\icpinlb}
    \savedanchor\icpinlc{\pgfpoint{-3.2\IClen}{0\IClen}}  \anchor{p3}{\icpinlc}
    \savedanchor\icpinld{\pgfpoint{-3.2\IClen}{-1\IClen}}  \anchor{p4}{\icpinld}
    \savedanchor\icpinle{\pgfpoint{-3.2\IClen}{-2\IClen}}  \anchor{p5}{\icpinle}
    \savedanchor\icpinlf{\pgfpoint{-3.2\IClen}{-3\IClen}} \anchor{p6}{\icpinlf}

% starting from the bottom right corner and going up:
    \savedanchor\icpinrf{\pgfpoint{3.2\IClen}{-3\IClen}}  \anchor{p7}{\icpinrf}
    \savedanchor\icpinre{\pgfpoint{3.2\IClen}{-2\IClen}}  \anchor{p8}{\icpinre}
    \savedanchor\icpinrd{\pgfpoint{3.2\IClen}{-1\IClen}}  \anchor{p9}{\icpinrd}
    \savedanchor\icpinrc{\pgfpoint{3.2\IClen}{0\IClen}}  \anchor{p10}{\icpinrc}
    \savedanchor\icpinrb{\pgfpoint{3.2\IClen}{1\IClen}}  \anchor{p11}{\icpinrb}
    \savedanchor\icpinra{\pgfpoint{3.2\IClen}{2\IClen}}  \anchor{p12}{\icpinra}

    
    \foregroundpath{ % border and pin numbers are drawn here
        % -------------------------------
        %        Draw Border
        % -------------------------------
    \pgfsetlinewidth{0.1\IClen}

    \def\ICheight{8.5}           % height and width of the integrated circuit
    \def\ICwidth{8}         

    \def\halfh{4.25}             % half height and width
    \def\halfw{4} 

    \def\topLim{3.5}             % distance from top that edge will taper
    \def\bottomLim{-3.5}
    \def\leftLim{-3.5}
    \def\rightLim{3.5}

    %\TikzBipolePath{norator}{#1}

    \pgfpathmoveto{\pgfpoint{\leftLim \IClen}{\halfh \IClen}}
    \pgfpathlineto{\pgfpoint{\rightLim \IClen}{\halfh \IClen}}
    \pgfpathlineto{\pgfpoint{\halfw \IClen}{\topLim \IClen}}
    %\pgfsetcornersacred{\pgfpoint{\halfw \IClen}{\topLim \IClen}}
    \pgfpathlineto{\pgfpoint{\halfw \IClen}{\bottomLim \IClen}}
    \pgfpathlineto{\pgfpoint{\rightLim \IClen}{-\halfh \IClen}}
    \pgfpathlineto{\pgfpoint{\leftLim \IClen}{-\halfh \IClen}}
    \pgfpathlineto{\pgfpoint{-\halfw \IClen}{\bottomLim \IClen}}
    \pgfpathlineto{\pgfpoint{-\halfw \IClen}{\topLim \IClen}}
    \pgfpathclose

    %draw holes for IO
    \pgfusepath{draw}  
    \pgfsetlinewidth{0.06\IClen}
    
    \def\limit{3.2}

    % top left down
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{2.0\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{1.0\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{0\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{-1\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{-2\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{-\limit\IClen}{-3\IClen}}{0.3\IClen}
    
    % top right down
    \pgfpathcircle{\pgfpoint{\limit\IClen}{2\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{\limit\IClen}{1\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{\limit\IClen}{0\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{\limit\IClen}{-1\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{\limit\IClen}{-2\IClen}}{0.3\IClen}
    \pgfpathcircle{\pgfpoint{\limit\IClen}{-3\IClen}}{0.3\IClen}


    %draw pin labels
    \pgfusepath{draw}  
    \def\labelLimit{2} 
    \def\shiftLeft{1.75}
    % top left down
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{2.0\IClen}]{\pinsize $V_{DD}$}
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{1.0\IClen}]{\pinsize CTS}
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{0.0\IClen}]{\pinsize TXD}
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{-1.0\IClen}]{\pinsize RXD}
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{-2.0\IClen}]{\pinsize RTS}
    \pgftext[at=\pgfpoint{-\labelLimit\IClen}{-3.0\IClen}]{\pinsize GND}

    % top right down

    \pgftext[at=\pgfpoint{\shiftLeft\IClen}{2\IClen}]{\pinsize SWCLK}
    \pgftext[at=\pgfpoint{\shiftLeft\IClen}{1\IClen}]{\pinsize SWDIO}
    \pgftext[at=\pgfpoint{\labelLimit\IClen}{0\IClen}]{\pinsize P04}
    \pgftext[at=\pgfpoint{\labelLimit\IClen}{-1\IClen}]{\pinsize P05}
    \pgftext[at=\pgfpoint{\labelLimit\IClen}{-2\IClen}]{\pinsize GND}
    \pgftext[at=\pgfpoint{\labelLimit\IClen}{-3\IClen}]{\pinsize $V_{IN}$}
}}



%\begin{document}
    %\begin{circuitikz}
        %\node[bleNano, pin spacing=5mm] (IC) at (0,0) {\textbf{BLE Nano (V1.5)}};
    %\end{circuitikz}
%\end{document}



