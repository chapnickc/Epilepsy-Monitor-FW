\documentclass{article}
\usepackage[margin=2cm]{geometry}
\usepackage[fleqn]{amsmath}
\usepackage[hidelinks]{hyperref} 
\usepackage{circuitikz}
\usepackage{titling}
\usepackage{color}
\usepackage{tikz}
\usepackage{fp}

\input{bleNano}          % add the code for the bleNano diagram
\input{TMP006}           % for TMP006 diagram

\setlength{\droptitle}{-2.0cm} 

\begin{document}

\title{LifeBud Project}
\author{Chad Chapnick \\ 
        Saint Louis University Biomedical Engineering Department}
\maketitle
\vspace{-0.75cm}
\noindent\hfil\rule{0.5\textwidth}{.4pt}\hfil

\section*{Hardware}

%The Raytak Module is the silver piece on top of the BLE Nano. Among other things, it incorporates a relatively-powerful 32 bit processor and a 2.4 GHz RF transceiver for BLE communication. The specs can be found on page 5 of the documentation that Alec linked to. 
%With that in mind,  the BLE Nano basically seems like a breakout board for the MDBT40. On its own, the module seems to have everything we need (I2C, 32 kB of RAM for computationally-light signal processing, etc.). Therefore, we can potentially save space by eliminating unnecessary design features, as Alec suggested.
%To get ideas for how we can make a minimal PCB, you could look at pages 10-15 of Nordic's documentation for the nrf51822 (the module on which Raytak's MDBT40 is based). They have great diagrams information on dimensions, pins, etc. that could be helpful. 
%As a side note, being that Nordic is one of the SIG members, the nrf51822 module might be a better option. We could also consider the modules at Rigado.

For the SDA and SCL connections we need pull up resistors. 
These are used to ensure that inputs to logic systems settle at expected logic levels if external devices are disconnected 
or high-impedance is introduced. Usually used with open-collector or open drain outputs.

\section*{Circuit Diagram}
\begin{figure}[h!]
    \centering

    \definecolor{sdaColor}{RGB}{22,155,98}
    \definecolor{sclColor}{RGB}{255,122,20}
    \definecolor{VddColor}{RGB}{134,88,88}

\begin{circuitikz}
    \node[bleNano, pin spacing=5mm, scale=0.85] (IC) at (0,0) {\textbf{BLE Nano (V1.5)}};
    \node[TMP006, pin spacing=5mm, scale=0.75] (TMP) at (5.5,-6) {\textbf{TMP006}};

    \draw[sdaColor]  % SDA connections
        (IC.p9) to[short, *-,color=sdaColor] (IC.p9) -| (TMP.p6) %  
        (TMP.p6) to[short, *-,color=sdaColor] (TMP.p6) |- (IC.p9);

    \draw[sclColor]  % SCL connections
        (IC.p10) to[short, *-, color=sclColor] (IC.p10) -| (TMP.p5)
        (TMP.p5) to[short, *-, color=sclColor] (TMP.p5) |- (IC.p10);
        
    \draw % add battery
        (9,-3) coordinate (anode) 
        to[battery1] ++(0, 1) coordinate (cathode)
        (10, -2.85) node[label={3.3 $V$}] {};

    
     % add universal ground
    \draw (anode) to[short] ++(0, -0.75) node[ground] {};
    \ctikzset{bipoles/resistor/height=0.2}
    \ctikzset{bipoles/resistor/width=0.75}
    \draw[red] % connect Vin's
        (IC.p7) to[short, *-, color=red] (IC.p7) -| (cathode)
        (TMP.p7) to[short, *-*, color=red]  ++(0, 3.42);
    
    \draw[thick, VddColor]  
            (IC.p1) to[short, *-, color=VddColor] 
            % go out to left then up
            (IC.p1) -| (-1.9,  2.1) coordinate (anchor)
            (anchor) to[short, -*,color=VddColor] ++(8.15, 0) coordinate(VddConnect);

    \draw[thick, VddColor] 
            % draw left pull up resistor 
            (VddConnect) to[short] ++(-0.38, 0) coordinate (anchor);


    \draw[sclColor] 
        (anchor) to[/tikz/circuitikz/bipoles/length=20pt,R, l_=$R_{P}$, *-*, color=sclColor] ++(0, -2.1);

    \draw[sdaColor] 
            (VddConnect) to[/tikz/circuitikz/bipoles/length=20pt,R, l=$R_{P}$, *-*, color=sdaColor] ++(0, -2.54);

    \def\tmpGndy{1.5}

    \draw[blue]  % add ground connections
        (TMP.p1) to[short, *-*, color=blue] ++(0, \tmpGndy) coordinate (tmpGndNode)
        (TMP.p2) to[short, *-*, color=blue] ++(0, \tmpGndy) 
        (TMP.p2) to[short, *-, color=blue] (TMP.p2) |- (tmpGndNode)
        (TMP.p3) to[short, *-*, color=blue] ++(0, \tmpGndy) coordinate (p3GndNode)
        (TMP.p3) to[short, *-, color=blue] (TMP.p3) |- (tmpGndNode)
        (IC.p8) to[short, *-, color=blue] (IC.p8) -| (tmpGndNode)
        (p3GndNode) to[short, -*, color=blue] ++(3.865,0);

\end{circuitikz}
\end{figure}

\section*{Calculations}
To calculate the value of the pull up resistor needed for the temperature sensor:

\url{http://www.ti.com/lit/ds/symlink/tmp006.pdf}

\url{http://www.ti.com/lit/an/slva689/slva689.pdf}


\begin{itemize}
    \item Low-Level Output Current ($I_{OL}$) : 6 mA
    \item Output Low Voltage ($V_{OL}$): 0.4 V
\end{itemize}

\begin{align*}
    R_{P(min)} & = \frac{V_{CC} - V_{OL(max)}}{I_{OL}} 
               = \frac{ 3.3 \enspace V - 0.4 \enspace V }{6 \enspace mA} \\
               & \approx 483.33 \enspace \Omega
\end{align*}

%$t_r = t_2 - t_1 = 0.8473 \cdot R_P \cdot $
\begin{align*}
    R_{P(max)} & = \frac{t_r}{0.8473 \cdot C_b} 
                 = \frac{300 \enspace ns}{0.8473 \cdot (3 \enspace pF)} \\
               & \approx 118 \enspace k\Omega
\end{align*}
%\section{Software}

%I briefly mentioned that I've been working on the build system. What I'm referring to here is using the Nordic nRF51 Software Development Kit (SDK), MBED libraries and the GNU ARM Compiler to write code for the module. Here is a great blog post about it. 
%The SDKs use some C and C++, but I am using pure C++ to program the nrf51822, as well as building some Python tools for project management. I'm also making use of the CMake command-line utility in order to simplify the build process. It makes things like including relevant headers (.h files) and implementation (.cpp) files, and writing custom commands much easier. The end-product of the build is a hex file (.hex) which I upload to the board using the MK20 dongle. With the exception of uploading code, this build process should work for whichever module we choose, so long as it has an ARM processor. 
%As of now, (most of) the code should be uploaded to the Drive; however the most recent version can be found in the 'dev' branch of the project on my github. It's a private repository, so you need to be added as a collaborator to view it. This requires a GitHub account, so if you're interested send me your username and I will add ya. 
%I'm using git because it offers unparalleled version control which, for a project of this size, is a necessity. Because of the way git works, I made Drive sync with the 'master' branch. I plan to update that branch whenever I have working improvements to the project. 

\end{document}

